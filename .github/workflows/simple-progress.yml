name: ğŸ“Š Auto Update Progress

on:
  push:
    branches: [ main ]

jobs:
  update-readme:
    name: ğŸ“ˆ Update Progress in README
    runs-on: ubuntu-latest
    
    permissions:
      contents: write  # Cáº§n write permission Ä‘á»ƒ push changes
      actions: read    # Äá»ƒ Ä‘á»c workflow info
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ“Š Count problems and update README
        run: |
          # Äáº¿m sá»‘ problems theo Ä‘á»™ khÃ³
          EASY_COUNT=$(find src -name "*.kt" -path "*/easy/*" | wc -l)
          MEDIUM_COUNT=$(find src -name "*.kt" -path "*/medium/*" | wc -l) 
          HARD_COUNT=$(find src -name "*.kt" -path "*/hard/*" | wc -l)
          TOTAL_COUNT=$((EASY_COUNT + MEDIUM_COUNT + HARD_COUNT))
          
          echo "ğŸ“Š Current stats: Easy=$EASY_COUNT, Medium=$MEDIUM_COUNT, Hard=$HARD_COUNT, Total=$TOTAL_COUNT"
          
          # Cáº­p nháº­t README náº¿u cÃ³ thay Ä‘á»•i
          if [ $TOTAL_COUNT -gt 0 ]; then
            # Update progress section in README
            sed -i "s/ğŸ¯ Progress: [0-9]* problems/ğŸ¯ Progress: $TOTAL_COUNT problems/g" README.md
          
            # Táº¡o progress section náº¿u chÆ°a cÃ³
            if ! grep -q "ğŸ¯ Progress:" README.md; then
              echo "" >> README.md
              echo "## ğŸ“Š Progress" >> README.md
              echo "" >> README.md
              echo "ğŸ¯ Progress: $TOTAL_COUNT problems solved!" >> README.md
              echo "- ğŸŸ¢ Easy: $EASY_COUNT" >> README.md
              echo "- ğŸŸ¡ Medium: $MEDIUM_COUNT" >> README.md
              echo "- ğŸ”´ Hard: $HARD_COUNT" >> README.md
            fi
          fi

      - name: ğŸ“ Commit if changed
        run: |
          git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          if [ -n "$(git status --porcelain README.md)" ]; then
            git add README.md
            git commit -m "ğŸ“Š Auto-update: $(find src -name "*.kt" | wc -l) problems solved"
            git push
            echo "âœ… README updated!"
          else
            echo "â„¹ï¸ No changes needed"
          fi